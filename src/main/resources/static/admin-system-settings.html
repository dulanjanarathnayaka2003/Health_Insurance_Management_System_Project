<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin System Settings - HealthInsure</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <style>
        :root {
            --bg-gradient-1: #020617;
            --bg-gradient-2: #0f172a;
            --accent-cyan: #22d3ee;
            --accent-violet: #a855f7;
            --accent-pink: #ec4899;
            --card-bg: rgba(15, 23, 42, 0.85);
            --border-subtle: rgba(148, 163, 184, 0.35);
            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
            --danger: #f97373;
            --success: #22c55e;
            --warning: #f59e0b;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: radial-gradient(circle at top, #0f172a 0, #020617 55%, #000 100%);
            min-height: 100vh;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', system-ui, -system-ui, sans-serif;
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-orbit {
            position: fixed;
            inset: 0;
            overflow: hidden;
            z-index: -2;
        }

        .bg-orbit::before, .bg-orbit::after {
            content: "";
            position: absolute;
            width: 480px;
            height: 480px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 30%, rgba(56, 189, 248, 0.75), transparent 60%);
            filter: blur(4px);
            opacity: 0.55;
            animation: floatOrb 18s ease-in-out infinite;
        }

        .bg-orbit::after {
            top: auto; left: auto; right: -120px; bottom: -160px;
            background: radial-gradient(circle at 70% 70%, rgba(168, 85, 247, 0.85), transparent 60%);
            animation-delay: -9s;
        }

        .bg-grid {
            position: fixed;
            inset: 0;
            background-image:
                    linear-gradient(to right, rgba(148, 163, 184, 0.08) 1px, transparent 1px),
                    linear-gradient(to bottom, rgba(148, 163, 184, 0.08) 1px, transparent 1px);
            background-size: 40px 40px;
            opacity: 0.7;
            mask-image: radial-gradient(circle at center, black 0, black 45%, transparent 80%);
            z-index: -1;
            animation: gridDrift 36s linear infinite;
        }

        @keyframes floatOrb {
            0%, 100% { transform: translate3d(-160px, -120px, 0) scale(1); }
            25% { transform: translate3d(40px, -200px, 0) scale(1.05); }
            50% { transform: translate3d(220px, 40px, 0) scale(1.08); }
            75% { transform: translate3d(-40px, 140px, 0) scale(1.03); }
        }

        @keyframes gridDrift {
            0% { transform: translate3d(0, 0, 0) scale(1); }
            50% { transform: translate3d(-40px, -20px, 0) scale(1.02); }
            100% { transform: translate3d(0, 0, 0) scale(1); }
        }

        /* Header */
        header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .brand-lockup {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .brand-mark {
            width: 80px;
            height: 80px;
            border-radius: 16px;
            background: radial-gradient(circle at 30% 20%, #e5faff 0, #22d3ee 40%, #0ea5e9 75%, #0f172a 100%);
            box-shadow:
                    0 0 0 1px rgba(148, 163, 184, 0.3),
                    0 18px 40px rgba(15, 23, 42, 0.9),
                    0 0 30px rgba(34, 211, 238, 0.4);
            position: relative;
            overflow: hidden;
            display: grid;
            place-items: center;
            animation: logoFloat 3s ease-in-out infinite, logoGlow 2s ease-in-out infinite;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .brand-mark:hover {
            transform: scale(1.05) rotate(5deg);
            box-shadow:
                    0 0 0 1px rgba(148, 163, 184, 0.5),
                    0 25px 50px rgba(15, 23, 42, 1),
                    0 0 50px rgba(34, 211, 238, 0.6);
        }

        .brand-mark::before {
            content: "";
            position: absolute;
            inset: -2px;
            border-radius: 18px;
            background: linear-gradient(45deg, rgba(34, 211, 238, 0.8), rgba(168, 85, 247, 0.8), rgba(34, 211, 238, 0.8));
            background-size: 200% 200%;
            opacity: 0;
            z-index: -1;
            animation: logoShimmer 3s ease-in-out infinite;
        }

        .brand-mark img {
            width: 72px;
            height: 72px;
            object-fit: contain;
            border-radius: 12px;
            background: #0f172a;
            box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.35);
            animation: logoImagePulse 2.5s ease-in-out infinite;
            transition: transform 0.3s ease;
        }

        .brand-mark:hover img {
            transform: scale(1.08);
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        @keyframes logoGlow {
            0%, 100% {
                box-shadow:
                        0 0 0 1px rgba(148, 163, 184, 0.3),
                        0 18px 40px rgba(15, 23, 42, 0.9),
                        0 0 30px rgba(34, 211, 238, 0.4);
            }
            50% {
                box-shadow:
                        0 0 0 1px rgba(148, 163, 184, 0.4),
                        0 20px 45px rgba(15, 23, 42, 1),
                        0 0 40px rgba(34, 211, 238, 0.6);
            }
        }

        @keyframes logoShimmer {
            0% { background-position: 0% 50%; opacity: 0; }
            50% { opacity: 0.3; }
            100% { background-position: 200% 50%; opacity: 0; }
        }

        @keyframes logoImagePulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.95; }
        }

        .brand-text-main {
            font-size: 1.8rem;
            font-weight: 600;
            letter-spacing: 0.09em;
            text-transform: uppercase;
            color: #e5e7eb;
        }

        .brand-text-sub {
            margin-top: 3px;
            font-size: 0.78rem;
            letter-spacing: 0.24em;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .logout-btn {
            background: linear-gradient(135deg, #22d3ee, #a855f7);
            color: #0b1120;
            margin-left: 12px;
            padding: 10px 20px;
            border-radius: 999px;
            box-shadow: 0 8px 20px rgba(8, 47, 73, 0.7);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
            box-shadow: 0 12px 30px rgba(8, 47, 73, 0.9);
        }

        /* Main Container */
        .main-glass {
            background:
                    radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.18), transparent 55%),
                    linear-gradient(135deg, rgba(15, 23, 42, 0.92), rgba(15, 23, 42, 0.86));
            box-shadow:
                    0 25px 60px rgba(15, 23, 42, 0.95),
                    0 0 0 1px rgba(148, 163, 184, 0.4);
            border: 1px solid rgba(148, 163, 184, 0.35);
            border-radius: 22px;
            max-width: 1280px;
            margin: 32px auto;
            padding: 2.5rem 2.1rem 2rem;
            position: relative;
            z-index: 2;
            animation: cardEnter 1.2s cubic-bezier(.68,-0.55,.27,1.55) both;
        }

        @keyframes cardEnter {
            0% { opacity: 0; transform: translateY(60px) scale(0.97); }
            60% { opacity: 1; transform: translateY(-8px) scale(1.015); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Settings Cards */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .settings-card {
            background:
                    radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.18), transparent 55%),
                    linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.85));
            border: 1px solid rgba(148, 163, 184, 0.35);
            padding: 2rem;
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .settings-card:hover {
            transform: translateY(-4px) scale(1.02);
            border-color: var(--accent-cyan);
            box-shadow: 0 12px 40px rgba(34, 211, 238, 0.3);
        }

        .settings-card h3 {
            margin: 0 0 1rem 0;
            color: var(--text-main);
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .settings-card h3 i {
            color: var(--accent-cyan);
        }

        .settings-card p {
            margin: 0 0 1.5rem 0;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 17px;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-main);
            display: block;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.18), transparent 60%);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 0.875rem 1rem;
            font-size: 0.875rem;
            color: var(--text-main);
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: 0 0 0 1px rgba(34, 211, 238, 0.3), 0 0 0 12px rgba(15, 23, 42, 0.8);
            background-color: rgba(15, 23, 42, 0.9);
            transform: translateY(-1px);
        }

        .form-group input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.7rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.8rem;
            cursor: pointer;
        }

        select:focus {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2322d3ee' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        }

        select option {
            background: #0f172a;
            color: var(--text-main);
        }

        /* Buttons */
        .btn, .btn-info, .btn-danger, .btn-success {
            border: none;
            border-radius: 12px;
            font-weight: 600;
            padding: 0.82rem 2rem;
            font-size: 1rem;
            cursor: pointer;
            outline: none;
            transition: all 0.2s ease;
            margin: 3px 8px 3px 0;
            display: inline-flex;
            align-items: center;
            gap: 0.45em;
            font-family: inherit;
            text-decoration: none;
        }

        .btn, .btn-info {
            background: linear-gradient(135deg, #22d3ee, #a855f7);
            color: #0b1120;
            box-shadow: 0 8px 20px rgba(8, 47, 73, 0.7);
        }

        .btn:hover, .btn-info:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
            box-shadow: 0 12px 30px rgba(8, 47, 73, 0.9);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f97373, #ef4444);
            color: #fff;
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
        }

        .btn-danger:hover {
            box-shadow: 0 12px 30px rgba(239, 68, 68, 0.6);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: #fff;
            box-shadow: 0 8px 20px rgba(34, 197, 94, 0.4);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(34, 197, 94, 0.6);
        }

        /* Messages */
        .message {
            padding: 12px 21px 13px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            margin-top: 9px;
            margin-bottom: 4px;
            box-shadow: 0 1px 6px rgba(0,0,0,0.05);
            border: 1px solid var(--border-subtle);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .success {
            background: rgba(22, 163, 74, 0.2);
            border-color: rgba(22, 163, 74, 0.4);
            color: #bbf7d0;
        }

        .error {
            background: rgba(127, 29, 29, 0.7);
            border-color: rgba(248, 113, 113, 0.8);
            color: #fecaca;
        }

        /* System Status */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-online {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.4);
        }

        .status-offline {
            background: rgba(248, 113, 113, 0.2);
            color: #f97373;
            border: 1px solid rgba(248, 113, 113, 0.4);
        }

        .status-maintenance {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.4);
        }

        /* Tabs */
        .tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0 30px;
            gap: 0.5rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            padding-bottom: 10px;
        }

        .tab {
            padding: 10px 24px;
            background: transparent;
            border-radius: 18px;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 0.5em;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .tab:hover {
            background: rgba(148, 163, 184, 0.1);
        }

        .tab.active {
            background: linear-gradient(135deg, #22d3ee, #a855f7);
            color: #0b1120;
            border: 1px solid rgba(34, 211, 238, 0.5);
            box-shadow: 0 2px 8px rgba(34, 211, 238, 0.3);
        }

        /* Content sections */
        .content {
            display: none;
            animation: fadeIn 0.3s ease-out both;
        }

        .content.active {
            display: block;
        }

        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        /* Table styling */
        .beautiful-table {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(148, 163, 184, 0.35);
            margin-top: 1.5rem;
        }

        .beautiful-table table {
            width: 100%;
            border-collapse: collapse;
            background: transparent;
        }

        .beautiful-table thead {
            background: rgba(148, 163, 184, 0.15);
            color: var(--text-main);
        }

        .beautiful-table th {
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-main);
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }

        .beautiful-table tbody tr {
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .beautiful-table tbody tr:hover {
            background: rgba(148, 163, 184, 0.1);
        }

        .beautiful-table tbody tr:last-child {
            border-bottom: none;
        }

        .beautiful-table td {
            padding: 14px 16px;
            font-size: 0.95rem;
            color: var(--text-main);
            border: none;
            vertical-align: middle;
        }

        .beautiful-table .status-active {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.02em;
            display: inline-block;
            border: 1px solid rgba(34, 197, 94, 0.4);
        }

        .beautiful-table .status-inactive {
            background: rgba(248, 113, 113, 0.2);
            color: #f97373;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.02em;
            display: inline-block;
            border: 1px solid rgba(248, 113, 113, 0.4);
        }

        .beautiful-table .role-badge {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-main);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.02em;
            display: inline-block;
            border: 1px solid rgba(148, 163, 184, 0.35);
        }

        .beautiful-table .id-cell {
            font-weight: 600;
            color: var(--accent-cyan);
            font-size: 0.95rem;
        }

        .input-group {
            display: flex;
            align-items: center;
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 16px;
            color: var(--text-muted);
            font-size: 1rem;
            pointer-events: none;
            z-index: 1;
        }

        .form-group .input-group input,
        .form-group .input-group select {
            padding-left: 2.5rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-glass {
                margin: 16px;
                padding: 1.5rem 1rem;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            header {
                padding: 1rem;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .brand-lockup {
                justify-content: center;
            }

            .brand-mark {
                width: 60px;
                height: 60px;
            }

            .brand-mark img {
                width: 54px;
                height: 54px;
            }

            .brand-text-main {
                font-size: 1.4rem;
            }

            .tabs {
                gap: 0.3rem;
            }

            .tab {
                padding: 8px 16px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
<div class="bg-orbit"></div>
<div class="bg-grid"></div>

<header>
    <div class="header-content">
        <div class="brand-lockup">
            <div class="brand-mark">
                <img src="Lanka.jpeg" alt="HealthInsure Logo">
            </div>
            <div>
                <div class="brand-text-main">Admin Settings</div>
                <div class="brand-text-sub">System Management</div>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div class="status-indicator status-online">
                <i class="fas fa-circle"></i>
                <span>System Online</span>
            </div>
            <button onclick="logout()" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
    </div>
</header>

<div class="main-glass">
    <h1 style="text-align: center; margin-bottom: 2rem; font-size: 2rem; font-weight: 600;">System Administration</h1>

    <!-- Tabs -->
    <div class="tabs">
        <div class="tab active" onclick="openTab('system-settings', event)"><i class="fas fa-cogs"></i> System Settings</div>
        <div class="tab" onclick="openTab('manage-users', event)"><i class="fas fa-users-cog"></i> Manage Users</div>
        <div class="tab" onclick="openTab('monitor-system', event)"><i class="fas fa-chart-line"></i> Monitor System</div>
        <div class="tab" onclick="openTab('generate-audit', event)"><i class="fas fa-file-pdf"></i> Audit Log</div>
    </div>

    <!-- System Settings Tab -->
    <div id="system-settings" class="content active">
    <!-- Settings Cards -->
    <div class="settings-grid">
        <!-- System Configuration -->
        <div class="settings-card">
            <h3><i class="fas fa-cogs"></i> System Configuration</h3>
            <p>Manage core system settings and parameters</p>

            <div class="form-group">
                <label for="siteName">Site Name</label>
                <input type="text" id="siteName" value="HealthInsure" placeholder="Enter site name">
            </div>

            <div class="form-group">
                <label for="siteEmail">Admin Email</label>
                <input type="email" id="siteEmail" value="admin@healthinsure.lk" placeholder="Enter admin email">
            </div>

            <div class="form-group">
                <label for="timezone">Timezone</label>
                <select id="timezone">
                    <option value="Asia/Colombo">Asia/Colombo (UTC+5:30)</option>
                    <option value="UTC">UTC</option>
                    <option value="America/New_York">America/New_York (UTC-5)</option>
                    <option value="Europe/London">Europe/London (UTC+0)</option>
                </select>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="maintenanceMode"> Enable Maintenance Mode
                </label>
            </div>

            <button onclick="saveSystemConfig()" class="btn-success">
                <i class="fas fa-save"></i> Save Configuration
            </button>
        </div>

        <!-- Security Settings -->
        <div class="settings-card">
            <h3><i class="fas fa-shield-alt"></i> Security Settings</h3>
            <p>Configure security policies and authentication</p>

            <div class="form-group">
                <label for="sessionTimeout">Session Timeout (minutes)</label>
                <input type="number" id="sessionTimeout" value="30" min="15" max="480">
            </div>

            <div class="form-group">
                <label for="passwordExpiry">Password Expiry (days)</label>
                <input type="number" id="passwordExpiry" value="90" min="30" max="365">
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="twoFactorAuth" checked> Enable Two-Factor Authentication
                </label>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="loginNotifications" checked> Send Login Notifications
                </label>
            </div>

            <div class="form-group">
                <label for="maxLoginAttempts">Max Login Attempts</label>
                <input type="number" id="maxLoginAttempts" value="5" min="3" max="10">
            </div>

            <button onclick="saveSecuritySettings()" class="btn-success">
                <i class="fas fa-save"></i> Save Security Settings
            </button>
        </div>

        <!-- Email Configuration -->
        <div class="settings-card">
            <h3><i class="fas fa-envelope"></i> Email Configuration</h3>
            <p>Configure email server and notification settings</p>

            <div class="form-group">
                <label for="smtpServer">SMTP Server</label>
                <input type="text" id="smtpServer" value="smtp.gmail.com" placeholder="SMTP server address">
            </div>

            <div class="form-group">
                <label for="smtpPort">SMTP Port</label>
                <input type="number" id="smtpPort" value="587" placeholder="SMTP port">
            </div>

            <div class="form-group">
                <label for="smtpUsername">SMTP Username</label>
                <input type="text" id="smtpUsername" value="noreply@healthinsure.lk" placeholder="SMTP username">
            </div>

            <div class="form-group">
                <label for="smtpPassword">SMTP Password</label>
                <input type="password" id="smtpPassword" placeholder="Enter SMTP password">
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="smtpSSL" checked> Use SSL/TLS
                </label>
            </div>

            <button onclick="testEmailConfig()" class="btn-info">
                <i class="fas fa-paper-plane"></i> Test Email
            </button>
            <button onclick="saveEmailConfig()" class="btn-success">
                <i class="fas fa-save"></i> Save Email Settings
            </button>
        </div>

        <!-- Backup & Maintenance -->
        <!-- Backup & Maintenance -->
        <div class="settings-card">
            <h3><i class="fas fa-database"></i> Backup & Maintenance</h3>
            <p>Manage system backups and maintenance tasks</p>

            <div class="form-group">
                <label for="backupFrequency">Backup Frequency</label>
                <select id="backupFrequency">
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                </select>
            </div>

            <div class="form-group">
                <label for="backupRetention">Backup Retention (days)</label>
                <input type="number" id="backupRetention" value="30" min="7" max="365">
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="autoBackup" checked> Enable Automatic Backups
                </label>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                <button onclick="createBackup()" class="btn-info">
                    <i class="fas fa-download"></i> Create Backup
                </button>
                <button onclick="restoreBackup()" class="btn">
                    <i class="fas fa-upload"></i> Restore Backup
                </button>
                <button onclick="clearCache()" class="btn-danger">
                    <i class="fas fa-broom"></i> Clear Cache
                </button>
            </div>
        </div>

        <!-- API Configuration -->
        <div class="settings-card">
            <h3><i class="fas fa-code"></i> API Configuration</h3>
            <p>Manage API settings and third-party integrations</p>

            <div class="form-group">
                <label for="apiRateLimit">API Rate Limit (requests/minute)</label>
                <input type="number" id="apiRateLimit" value="1000" min="100" max="10000">
            </div>

            <div class="form-group">
                <label for="apiTimeout">API Timeout (seconds)</label>
                <input type="number" id="apiTimeout" value="30" min="10" max="300">
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="apiLogging" checked> Enable API Logging
                </label>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="corsEnabled" checked> Enable CORS
                </label>
            </div>

            <button onclick="generateApiKey()" class="btn-info">
                <i class="fas fa-key"></i> Generate New API Key
            </button>
            <button onclick="saveApiConfig()" class="btn-success">
                <i class="fas fa-save"></i> Save API Settings
            </button>
        </div>

        <!-- Payment Gateway -->
        <div class="settings-card">
            <h3><i class="fas fa-credit-card"></i> Payment Gateway</h3>
            <p>Configure payment processing settings</p>

            <div class="form-group">
                <label for="paymentGateway">Payment Gateway</label>
                <select id="paymentGateway">
                    <option value="stripe">Stripe</option>
                    <option value="paypal">PayPal</option>
                    <option value="razorpay">Razorpay</option>
                </select>
            </div>

            <div class="form-group">
                <label for="merchantId">Merchant ID</label>
                <input type="text" id="merchantId" placeholder="Enter merchant ID">
            </div>

            <div class="form-group">
                <label for="publicKey">Public Key</label>
                <input type="text" id="publicKey" placeholder="Enter public key">
            </div>

            <div class="form-group">
                <label for="privateKey">Private Key</label>
                <input type="password" id="privateKey" placeholder="Enter private key">
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="testMode" checked> Test Mode
                </label>
            </div>

            <button onclick="testPaymentGateway()" class="btn-info">
                <i class="fas fa-credit-card"></i> Test Payment
            </button>
            <button onclick="savePaymentConfig()" class="btn-success">
                <i class="fas fa-save"></i> Save Payment Settings
            </button>
        </div>
    </div>

    </div>
    <!-- End System Settings Tab -->

    <!-- Manage Users Tab -->
    <div id="manage-users" class="content">
        <h3 style="margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 600; color: var(--text-main);">
            <i class="fas fa-users-cog" style="color: var(--accent-cyan); margin-right: 0.5rem;"></i>
            Manage Users
        </h3>
        <form id="userForm">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label>Username</label>
                    <div class="input-group">
                        <span class="input-icon"><i class="fa fa-user"></i></span>
                        <input type="text" id="username" placeholder="Username" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <div class="input-group">
                        <span class="input-icon"><i class="fa fa-envelope"></i></span>
                        <input type="email" id="email" placeholder="Email" required>
                    </div>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label>Password</label>
                    <div class="input-group">
                        <span class="input-icon"><i class="fa fa-lock"></i></span>
                        <input type="password" id="password" placeholder="Password" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <div class="input-group">
                        <span class="input-icon"><i class="fa fa-phone"></i></span>
                        <input type="tel" id="phone" placeholder="Phone Number" required>
                    </div>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label>Role</label>
                    <div class="input-group">
                        <span class="input-icon"><i class="fa fa-user-shield"></i></span>
                        <select id="role" onchange="toggleBankFields()" required>
                            <option value="ADMIN">Admin</option>
                            <option value="CUSTOMER">Customer</option>
                            <option value="CUSTOMER_SERVICE">Customer Service</option>
                            <option value="CLAIMS_PROCESSING">Claims Processing</option>
                            <option value="MARKETING">Marketing</option>
                            <option value="HR">HR Manager</option>
                            <option value="POLICYHOLDER">Policyholder</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <div class="input-group">
                        <span class="input-icon"><i class="fa fa-toggle-on"></i></span>
                        <select id="status" required>
                            <option value="true">Active</option>
                            <option value="false">Inactive</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div id="bankAccountFields" style="display: none; border: 2px solid var(--accent-cyan); padding: 15px; border-radius: 8px; margin: 15px 0; background: rgba(34, 211, 238, 0.1);">
                <h4 style="margin-top: 0; color: var(--accent-cyan); font-weight: 600;"><i class="fas fa-university mr-2"></i>Bank Account Information</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>Bank Name</label>
                        <div class="input-group">
                            <span class="input-icon"><i class="fa fa-university"></i></span>
                            <input type="text" id="bankName" placeholder="Bank Name (e.g., Bank of Ceylon)">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Account Number</label>
                        <div class="input-group">
                            <span class="input-icon"><i class="fa fa-credit-card"></i></span>
                            <input type="text" id="accountNumber" placeholder="Account Number">
                        </div>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>Account Holder Name</label>
                        <div class="input-group">
                            <span class="input-icon"><i class="fa fa-user-tag"></i></span>
                            <input type="text" id="accountHolderName" placeholder="Account Holder Name">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Branch (Optional)</label>
                        <div class="input-group">
                            <span class="input-icon"><i class="fa fa-map-marker-alt"></i></span>
                            <input type="text" id="branch" placeholder="Branch">
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <button type="button" onclick="saveUser()" class="btn"><i class="fas fa-save"></i> Save User</button>
                <button type="button" onclick="cancelForm()" class="btn-danger"><i class="fas fa-times"></i> Cancel</button>
            </div>
        </form>
        <div class="message" id="userMessage" style="display: none;"></div>
        
        <h4 style="margin-top: 2rem; margin-bottom: 1rem; color: var(--text-main); font-weight: 600;">
            <i class="fas fa-list mr-2"></i>User List
        </h4>
        <button onclick="loadUsers()" class="btn-success" style="margin-bottom: 10px;"><i class="fas fa-sync-alt"></i> Refresh User Table</button>
        <div class="beautiful-table">
            <table id="userTable">
                <thead>
                    <tr>
                        <th><i class="fas fa-hashtag mr-2"></i>ID</th>
                        <th><i class="fas fa-user mr-2"></i>Username</th>
                        <th><i class="fas fa-envelope mr-2"></i>Email</th>
                        <th><i class="fas fa-phone mr-2"></i>Phone</th>
                        <th><i class="fas fa-user-shield mr-2"></i>Role</th>
                        <th><i class="fas fa-toggle-on mr-2"></i>Status</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        
        <h4 style="margin-top: 2rem; margin-bottom: 1rem; color: var(--text-main); font-weight: 600;">
            <i class="fas fa-trash-alt mr-2"></i>Delete User
        </h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
            <div class="form-group">
                <label>User ID</label>
                <div class="input-group">
                    <span class="input-icon"><i class="fa fa-hashtag"></i></span>
                    <input type="number" id="deleteId" placeholder="User ID">
                </div>
            </div>
            <div style="display: flex; align-items: flex-end;">
                <button onclick="deleteUser()" class="btn-danger"><i class="fas fa-trash-alt"></i> Delete User</button>
            </div>
        </div>
    </div>

    <!-- Monitor System Tab -->
    <div id="monitor-system" class="content">
        <h3 style="margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 600; color: var(--text-main);">
            <i class="fas fa-chart-line" style="color: var(--accent-cyan); margin-right: 0.5rem;"></i>
            System Monitoring
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
            <div style="text-align: center; padding: 1.5rem; background: rgba(34, 211, 238, 0.1); border-radius: 12px; border: 1px solid rgba(34, 211, 238, 0.3);">
                <h4 style="margin: 0 0 10px 0; color: var(--accent-cyan); font-weight: 600;"><i class="fas fa-server mr-2"></i>System Status</h4>
                <p style="margin: 5px 0; color: var(--text-muted);"><strong>Status:</strong> <span id="statusText" style="color: var(--success); font-weight: bold;">Loading...</span></p>
                <p style="margin: 5px 0; color: var(--text-muted);"><strong>Uptime:</strong> <span id="uptime">Loading...</span></p>
                <p style="margin: 5px 0; color: var(--text-muted);"><strong>Database:</strong> <span id="databaseStatus">Loading...</span></p>
            </div>
            <div style="text-align: center; padding: 1.5rem; background: rgba(34, 197, 94, 0.1); border-radius: 12px; border: 1px solid rgba(34, 197, 94, 0.3);">
                <h4 style="margin: 0 0 10px 0; color: var(--success); font-weight: 600;"><i class="fas fa-users mr-2"></i>User Statistics</h4>
                <p style="margin: 5px 0; color: var(--text-muted);"><strong>Total Users:</strong> <span id="totalUsersMonitor">Loading...</span></p>
                <p style="margin: 5px 0; color: var(--text-muted);"><strong>Active Users:</strong> <span id="activeUsersMonitor">Loading...</span></p>
                <p style="margin: 5px 0; color: var(--text-muted);"><strong>Connections:</strong> <span id="connections">Loading...</span></p>
            </div>
            <div style="text-align: center; padding: 1.5rem; background: rgba(245, 158, 11, 0.1); border-radius: 12px; border: 1px solid rgba(245, 158, 11, 0.3);">
                <h4 style="margin: 0 0 10px 0; color: var(--warning); font-weight: 600;"><i class="fas fa-microchip mr-2"></i>System Resources</h4>
                <p style="margin: 5px 0; color: var(--text-muted);"><strong>Memory Usage:</strong> <span id="memoryUsage">Loading...</span></p>
                <p style="margin: 5px 0; color: var(--text-muted);"><strong>CPU Usage:</strong> <span id="cpuUsage">Loading...</span></p>
                <p style="margin: 5px 0; color: var(--text-muted);"><strong>Server Info:</strong> <span id="serverInfo">Loading...</span></p>
            </div>
            <div style="text-align: center; padding: 1.5rem; background: rgba(248, 113, 113, 0.1); border-radius: 12px; border: 1px solid rgba(248, 113, 113, 0.3);">
                <h4 style="margin: 0 0 10px 0; color: var(--danger); font-weight: 600;"><i class="fas fa-clock mr-2"></i>Last Updated</h4>
                <p style="margin: 5px 0; color: var(--text-muted);"><strong>Timestamp:</strong> <span id="timestamp">Loading...</span></p>
                <button onclick="refreshMetrics()" class="btn" style="margin-top: 10px; width: 100%;"><i class="fas fa-sync-alt"></i> Refresh Metrics</button>
            </div>
        </div>
    </div>

    <!-- Audit Log Tab -->
    <div id="generate-audit" class="content">
        <h3 style="margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 600; color: var(--text-main);">
            <i class="fas fa-file-pdf" style="color: var(--accent-cyan); margin-right: 0.5rem;"></i>
            Generate Audit Log
        </h3>
        <form id="auditForm">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label>Start Date & Time</label>
                    <div class="input-group">
                        <span class="input-icon"><i class="fa fa-calendar-alt"></i></span>
                        <input type="datetime-local" id="auditStartDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>End Date & Time</label>
                    <div class="input-group">
                        <span class="input-icon"><i class="fa fa-calendar-check"></i></span>
                        <input type="datetime-local" id="auditEndDate" required>
                    </div>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label>Log Type</label>
                    <div class="input-group">
                        <span class="input-icon"><i class="fa fa-filter"></i></span>
                        <select id="auditType" required>
                            <option value="ALL">All Activities</option>
                            <option value="USER_MANAGEMENT">User Management</option>
                            <option value="CLAIMS">Claims Processing</option>
                            <option value="PAYMENTS">Payments</option>
                            <option value="SYSTEM">System Events</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Report Format</label>
                    <div class="input-group">
                        <span class="input-icon"><i class="fa fa-file-pdf"></i></span>
                        <select id="auditFormat" required>
                            <option value="PDF">PDF Document</option>
                            <option value="DETAILED_PDF">Detailed PDF Report</option>
                        </select>
                    </div>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <button type="button" onclick="previewAuditLog()" class="btn-info"><i class="fas fa-eye"></i> Preview Audit Log</button>
                <button type="button" onclick="generateAudit()" class="btn-success"><i class="fas fa-download"></i> Generate & Download Log</button>
            </div>
        </form>
        <div class="message" id="auditMessage" style="display: none;"></div>
        
        <div id="auditPreview" style="display: none; margin-top: 30px; background: rgba(15, 23, 42, 0.6); padding: 20px; border-radius: 1.2rem; border: 1px solid rgba(34, 211, 238, 0.3);">
            <h4 style="margin-bottom: 1rem; color: var(--text-main); font-weight: 600;">
                <i class="fas fa-chart-bar mr-2" style="color: var(--accent-cyan);"></i>Audit Log Preview
            </h4>
            <p style="color: var(--text-muted);"><strong>Period:</strong> <span id="previewAuditPeriod" style="color: var(--text-main);"></span></p>
            <p style="color: var(--text-muted);"><strong>Type:</strong> <span id="previewAuditType" style="color: var(--text-main);"></span></p>
            <div id="auditStats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;"></div>
        </div>
    </div>
</div>

<script>
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        loadCurrentSettings();
        loadUsers();
        refreshMetrics();
    });

    function openTab(tabId, event) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        if (event && event.target) {
            event.target.classList.add('active');
        }
        if (tabId === 'manage-users') loadUsers();
        if (tabId === 'monitor-system') refreshMetrics();
    }

    function loadCurrentSettings() {
        // Load system settings from backend
        fetch('/api/admin/config', {
            credentials: 'same-origin'
        })
        .then(res => {
            if (res.ok) return res.json();
            return null;
        })
        .then(data => {
            if (data) {
                if (data.siteName) document.getElementById('siteName').value = data.siteName;
                if (data.siteEmail) document.getElementById('siteEmail').value = data.siteEmail;
                if (data.timezone) document.getElementById('timezone').value = data.timezone;
                if (data.maintenanceMode !== undefined) document.getElementById('maintenanceMode').checked = data.maintenanceMode;
            }
        })
        .catch(err => console.log('Settings not loaded:', err));
    }

    function loadUsers() {
        fetch('/api/admin/users', {
            credentials: 'same-origin'
        })
            .then(res => {
                if (res.status === 401) {
                    alert('Your session has expired. Please login again.');
                    window.location.href = '/login.html';
                    throw new Error('Unauthorized');
                }
                if (!res.ok) throw new Error('Failed to load users');
                return res.json();
            })
            .then(data => {
                const tbody = document.querySelector('#userTable tbody');
                if (!tbody) return;
                tbody.innerHTML = '';
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-muted);"><i class="fas fa-inbox mr-2"></i>No users found</td></tr>';
                    return;
                }
                
                data.forEach(user => {
                    const isActive = user.active || user.isActive;
                    const statusClass = isActive ? 'status-active' : 'status-inactive';
                    const statusText = isActive ? 'Active' : 'Inactive';
                    tbody.innerHTML += `<tr>
                        <td class="id-cell">${user.id}</td>
                        <td>${user.username}</td>
                        <td>${user.email || 'N/A'}</td>
                        <td>${user.phone || 'N/A'}</td>
                        <td><span class="role-badge">${user.role}</span></td>
                        <td><span class="${statusClass}">${statusText}</span></td>
                    </tr>`;
                });
            })
            .catch(err => {
                console.error('Error loading users:', err);
                const tbody = document.querySelector('#userTable tbody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--danger);"><i class="fas fa-exclamation-circle mr-2"></i>Error loading users</td></tr>';
                }
            });
    }

    function toggleBankFields() {
        const role = document.getElementById('role').value;
        const bankFields = document.getElementById('bankAccountFields');
        
        if (role === 'CUSTOMER') {
            bankFields.style.display = 'block';
            document.getElementById('bankName').required = true;
            document.getElementById('accountNumber').required = true;
            document.getElementById('accountHolderName').required = true;
        } else {
            bankFields.style.display = 'none';
            document.getElementById('bankName').required = false;
            document.getElementById('accountNumber').required = false;
            document.getElementById('accountHolderName').required = false;
        }
    }

    function saveUser() {
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const phone = document.getElementById('phone').value.trim();
        const role = document.getElementById('role').value;
        const status = document.getElementById('status').value === 'true';
        
        if (!username || !email || !password || !phone || !role) {
            showMessage('Please fill in all required fields', 'error', 'userMessage');
            return;
        }
        
        const dto = {
            username: username,
            email: email,
            password: password,
            phone: phone,
            role: role,
            active: status
        };
        
        if (role === 'CUSTOMER') {
            const bankName = document.getElementById('bankName').value.trim();
            const accountNumber = document.getElementById('accountNumber').value.trim();
            const accountHolderName = document.getElementById('accountHolderName').value.trim();
            
            if (!bankName || !accountNumber || !accountHolderName) {
                showMessage('Please fill in all bank account fields for Customer role', 'error', 'userMessage');
                return;
            }
            
            dto.bankName = bankName;
            dto.accountNumber = accountNumber;
            dto.accountHolderName = accountHolderName;
            dto.branch = document.getElementById('branch').value.trim();
        }
        
        fetch('/api/admin/users', { 
            method: 'POST', 
            headers: {'Content-Type': 'application/json'}, 
            body: JSON.stringify(dto),
            credentials: 'same-origin'
        })
            .then(res => {
                if (res.status === 401 || res.status === 302) {
                    alert('Your session has expired. Please login again.');
                    window.location.href = '/login.html';
                    throw new Error('Unauthorized');
                }
                if (!res.ok) {
                    return res.text().then(text => {
                        throw new Error(text || 'Failed to save user');
                    });
                }
                return res.json();
            })
            .then(data => {
                showMessage('User Added Successfully', 'success', 'userMessage');
                cancelForm();
                setTimeout(() => loadUsers(), 500);
            })
            .catch(err => {
                console.error('Save user error:', err);
                showMessage('Error: ' + err.message, 'error', 'userMessage');
            });
    }

    function deleteUser() {
        const id = document.getElementById('deleteId').value;
        if (!id) {
            showMessage('Please enter a User ID', 'error', 'userMessage');
            return;
        }
        if (!confirm('Are you sure you want to delete user ' + id + '?')) {
            return;
        }
        fetch(`/api/admin/users/${id}`, { 
            method: 'DELETE',
            credentials: 'same-origin'
        })
            .then(res => {
                if (res.ok) {
                    showMessage('User deleted successfully!', 'success', 'userMessage');
                    document.getElementById('deleteId').value = '';
                    loadUsers();
                } else {
                    throw new Error('Failed to delete user');
                }
            })
            .catch(err => {
                showMessage('Error: ' + err.message, 'error', 'userMessage');
            });
    }

    function cancelForm() {
        document.querySelectorAll('#userForm input, #userForm select').forEach(el => el.value = '');
        document.getElementById('bankAccountFields').style.display = 'none';
        document.getElementById('userMessage').style.display = 'none';
    }

    function refreshMetrics() {
        fetch('/api/admin/monitor', {
            credentials: 'same-origin'
        })
            .then(res => res.json())
            .then(data => {
                document.getElementById('statusText').textContent = data.status || 'Unknown';
                document.getElementById('statusText').style.color = data.status === 'Online' ? 'var(--success)' : 'var(--danger)';
                document.getElementById('uptime').textContent = data.uptime || 'N/A';
                document.getElementById('databaseStatus').textContent = data.databaseStatus || 'Unknown';
                document.getElementById('databaseStatus').style.color = data.databaseStatus === 'Connected' ? 'var(--success)' : 'var(--danger)';
                
                document.getElementById('totalUsersMonitor').textContent = data.totalUsers || '0';
                document.getElementById('activeUsersMonitor').textContent = data.activeUsers || '0';
                document.getElementById('connections').textContent = data.activeConnections || '0';
                
                document.getElementById('memoryUsage').textContent = data.memoryUsage ? data.memoryUsage.toFixed(2) + '%' : 'N/A';
                document.getElementById('cpuUsage').textContent = data.cpuUsage ? data.cpuUsage.toFixed(2) + '%' : 'N/A';
                document.getElementById('serverInfo').textContent = data.serverInfo || 'N/A';
                
                const timestamp = data.timestamp ? new Date(data.timestamp).toLocaleString() : 'N/A';
                document.getElementById('timestamp').textContent = timestamp;
            })
            .catch(err => {
                console.error('Error fetching metrics:', err);
                document.getElementById('statusText').textContent = 'Error';
                document.getElementById('statusText').style.color = 'var(--danger)';
            });
    }

    async function previewAuditLog() {
        const startDate = document.getElementById('auditStartDate').value;
        const endDate = document.getElementById('auditEndDate').value;
        const auditType = document.getElementById('auditType').value;
        
        if (!startDate || !endDate) {
            showMessage('Please select both start and end dates', 'error', 'auditMessage');
            return;
        }
        
        try {
            const usersResponse = await fetch('/api/admin/users');
            const users = await usersResponse.json();
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            const usersInRange = users.filter(u => {
                const createdAt = new Date(u.createdAt || Date.now());
                return createdAt >= start && createdAt <= end;
            });
            
            document.getElementById('previewAuditPeriod').textContent = `${new Date(startDate).toLocaleString()} to ${new Date(endDate).toLocaleString()}`;
            document.getElementById('previewAuditType').textContent = auditType;
            
            const statsHtml = `
                <div style="text-align: center; padding: 1rem; background: rgba(34, 211, 238, 0.1); border-radius: 12px; border: 1px solid rgba(34, 211, 238, 0.3);">
                    <h4 style="margin: 0 0 5px 0; color: var(--accent-cyan); font-size: 14px;"><i class="fas fa-users mr-2"></i>User Activities</h4>
                    <p style="margin: 0; font-size: 24px; font-weight: bold; color: var(--accent-cyan);">${usersInRange.length}</p>
                </div>
            `;
            
            document.getElementById('auditStats').innerHTML = statsHtml;
            document.getElementById('auditPreview').style.display = 'block';
            showMessage('Audit log preview generated successfully!', 'success', 'auditMessage');
            
        } catch (error) {
            console.error('Error generating preview:', error);
            showMessage('Failed to generate preview: ' + error.message, 'error', 'auditMessage');
        }
    }

    function generateAudit() {
        const start = document.getElementById('auditStartDate').value;
        const end = document.getElementById('auditEndDate').value;
        const type = document.getElementById('auditType').value;
        
        if (!start || !end) {
            showMessage('Please select both start and end dates', 'error', 'auditMessage');
            return;
        }
        
        // Convert to ISO format for backend
        const startISO = new Date(start).toISOString();
        const endISO = new Date(end).toISOString();
        
        fetch(`/api/admin/audit?startDate=${startISO}&endDate=${endISO}&type=${type}`, {
            credentials: 'same-origin'
        })
            .then(res => {
                if (!res.ok) throw new Error('Failed to generate audit log');
                return res.blob();
            })
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `audit_log_${start.replace(/:/g, '-')}_${end.replace(/:/g, '-')}.pdf`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                showMessage('Audit log generated and downloaded successfully!', 'success', 'auditMessage');
            })
            .catch(err => {
                console.error(err);
                showMessage('Error generating audit log: ' + err.message, 'error', 'auditMessage');
            });
    }

    function saveSystemConfig() {
        const siteName = document.getElementById('siteName').value;
        const siteEmail = document.getElementById('siteEmail').value;
        const timezone = document.getElementById('timezone').value;
        const maintenanceMode = document.getElementById('maintenanceMode').checked;

        fetch('/api/admin/config/system', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ siteName, siteEmail, timezone, maintenanceMode }),
            credentials: 'same-origin'
        })
        .then(res => {
            if (!res.ok) throw new Error('Failed to save system config');
            return res.json();
        })
        .then(data => {
            showMessage('System configuration saved successfully!', 'success');
        })
        .catch(err => {
            showMessage('Error: ' + err.message, 'error');
        });
    }

    function saveSecuritySettings() {
        const sessionTimeout = document.getElementById('sessionTimeout').value;
        const passwordExpiry = document.getElementById('passwordExpiry').value;
        const twoFactorAuth = document.getElementById('twoFactorAuth').checked;
        const loginNotifications = document.getElementById('loginNotifications').checked;
        const maxLoginAttempts = document.getElementById('maxLoginAttempts').value;

        fetch('/api/admin/config/security', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ sessionTimeout, passwordExpiry, twoFactorAuth, loginNotifications, maxLoginAttempts }),
            credentials: 'same-origin'
        })
        .then(res => {
            if (!res.ok) throw new Error('Failed to save security settings');
            return res.json();
        })
        .then(data => {
            showMessage('Security settings saved successfully!', 'success');
        })
        .catch(err => {
            showMessage('Error: ' + err.message, 'error');
        });
    }

    function testEmailConfig() {
        const smtpServer = document.getElementById('smtpServer').value;
        const smtpPort = document.getElementById('smtpPort').value;
        const smtpUsername = document.getElementById('smtpUsername').value;
        const smtpPassword = document.getElementById('smtpPassword').value;

        if (!smtpServer || !smtpPort || !smtpUsername) {
            showMessage('Please fill in all required email fields', 'error');
            return;
        }

        // Mock test - replace with actual API call
        console.log('Testing email configuration...');

        showMessage('Email test sent successfully!', 'success');
    }

    function saveEmailConfig() {
        const smtpServer = document.getElementById('smtpServer').value;
        const smtpPort = document.getElementById('smtpPort').value;
        const smtpUsername = document.getElementById('smtpUsername').value;
        const smtpPassword = document.getElementById('smtpPassword').value;
        const smtpSSL = document.getElementById('smtpSSL').checked;

        fetch('/api/admin/config/email', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ smtpServer, smtpPort, smtpUsername, smtpPassword, smtpSSL }),
            credentials: 'same-origin'
        })
        .then(res => {
            if (!res.ok) throw new Error('Failed to save email config');
            return res.json();
        })
        .then(data => {
            showMessage('Email configuration saved successfully!', 'success');
        })
        .catch(err => {
            showMessage('Error: ' + err.message, 'error');
        });
    }

    function createBackup() {
        // Mock backup creation - replace with actual API call
        console.log('Creating system backup...');

        showMessage('Backup created successfully!', 'success');
    }

    function restoreBackup() {
        // Mock backup restore - replace with actual API call
        console.log('Restoring system backup...');

        showMessage('Backup restored successfully!', 'success');
    }

    function clearCache() {
        // Mock cache clearing - replace with actual API call
        console.log('Clearing system cache...');

        showMessage('Cache cleared successfully!', 'success');
    }

    function generateApiKey() {
        // Mock API key generation - replace with actual API call
        const newKey = 'hk_live_' + Math.random().toString(36).substr(2, 32);
        console.log('Generated new API key:', newKey);

        showMessage(`New API key generated: ${newKey}`, 'success');
    }

    function saveApiConfig() {
        const apiRateLimit = document.getElementById('apiRateLimit').value;
        const apiTimeout = document.getElementById('apiTimeout').value;
        const apiLogging = document.getElementById('apiLogging').checked;
        const corsEnabled = document.getElementById('corsEnabled').checked;

        fetch('/api/admin/config/api', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ apiRateLimit, apiTimeout, apiLogging, corsEnabled }),
            credentials: 'same-origin'
        })
        .then(res => {
            if (!res.ok) throw new Error('Failed to save API config');
            return res.json();
        })
        .then(data => {
            showMessage('API configuration saved successfully!', 'success');
        })
        .catch(err => {
            showMessage('Error: ' + err.message, 'error');
        });
    }

    function testPaymentGateway() {
        const paymentGateway = document.getElementById('paymentGateway').value;
        const merchantId = document.getElementById('merchantId').value;
        const publicKey = document.getElementById('publicKey').value;
        const privateKey = document.getElementById('privateKey').value;

        if (!merchantId || !publicKey) {
            showMessage('Please fill in merchant ID and public key', 'error');
            return;
        }

        // Mock test - replace with actual API call
        console.log('Testing payment gateway:', paymentGateway);

        showMessage('Payment gateway test completed successfully!', 'success');
    }

    function savePaymentConfig() {
        const paymentGateway = document.getElementById('paymentGateway').value;
        const merchantId = document.getElementById('merchantId').value;
        const publicKey = document.getElementById('publicKey').value;
        const privateKey = document.getElementById('privateKey').value;
        const testMode = document.getElementById('testMode').checked;

        fetch('/api/admin/config/payment', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ paymentGateway, merchantId, publicKey, privateKey, testMode }),
            credentials: 'same-origin'
        })
        .then(res => {
            if (!res.ok) throw new Error('Failed to save payment config');
            return res.json();
        })
        .then(data => {
            showMessage('Payment configuration saved successfully!', 'success');
        })
        .catch(err => {
            showMessage('Error: ' + err.message, 'error');
        });
    }

    function restartServer() {
        if (confirm('Are you sure you want to restart the server? This will cause temporary downtime.')) {
            // Mock server restart - replace with actual API call
            console.log('Restarting server...');

            showMessage('Server restart initiated. Please wait...', 'error');

            setTimeout(() => {
                showMessage('Server restarted successfully!', 'success');
            }, 5000);
        }
    }

    function clearLogs() {
        if (confirm('Are you sure you want to clear all system logs? This action cannot be undone.')) {
            // Mock log clearing - replace with actual API call
            console.log('Clearing system logs...');

            showMessage('System logs cleared successfully!', 'success');
        }
    }

    function exportSettings() {
        // Mock settings export - replace with actual API call
        console.log('Exporting system settings...');

        // Create a mock download
        const settings = {
            siteName: document.getElementById('siteName').value,
            timezone: document.getElementById('timezone').value,
            sessionTimeout: document.getElementById('sessionTimeout').value,
            apiRateLimit: document.getElementById('apiRateLimit').value
        };

        const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'healthinsure-settings.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        showMessage('Settings exported successfully!', 'success');
    }

    function importSettings() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const settings = JSON.parse(e.target.result);
                        console.log('Importing settings:', settings);

                        // Apply imported settings
                        if (settings.siteName) document.getElementById('siteName').value = settings.siteName;
                        if (settings.timezone) document.getElementById('timezone').value = settings.timezone;
                        if (settings.sessionTimeout) document.getElementById('sessionTimeout').value = settings.sessionTimeout;
                        if (settings.apiRateLimit) document.getElementById('apiRateLimit').value = settings.apiRateLimit;

                        showMessage('Settings imported successfully!', 'success');
                    } catch (error) {
                        showMessage('Error importing settings. Please check the file format.', 'error');
                    }
                };
                reader.readAsText(file);
            }
        };
        input.click();
    }

    function showMessage(message, type, elementId) {
        if (elementId) {
            const messageEl = document.getElementById(elementId);
            if (messageEl) {
                messageEl.textContent = message;
                messageEl.className = `message ${type}`;
                messageEl.style.display = 'block';
                setTimeout(() => {
                    messageEl.style.display = 'none';
                }, 5000);
                return;
            }
        }
        // Create a temporary message element
        const messageEl = document.createElement('div');
        messageEl.className = `message ${type}`;
        messageEl.textContent = message;
        messageEl.style.position = 'fixed';
        messageEl.style.top = '20px';
        messageEl.style.right = '20px';
        messageEl.style.zIndex = '9999';

        document.body.appendChild(messageEl);

        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (document.body.contains(messageEl)) {
                document.body.removeChild(messageEl);
            }
        }, 5000);
    }

    function logout() {
        // Clear any stored data
        localStorage.clear();
        sessionStorage.clear();

        // Redirect to login
        window.location.href = '/login.html';
    }
</script>
</body>
</html>